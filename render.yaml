services:
  # Your WhatsApp Assistant (Flask + Gemini)
  - type: web
    name: waha-gemini-assistant
    runtime: docker
    region: oregon
    plan: free
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    envVars:
      - key: WAHA_URL
        value: https://whatsapp-service-xumb.onrender.com/api/sendText
      - key: WAHA_SESSION
        value: default
      - key: WAHA_KEEPALIVE_INTERVAL
        value: 600
      # Spotify redirect must match your Flask callback route
      - key: SPOTIFY_REDIRECT_URI
        value: https://waha-gemini-assistant.onrender.com/callback

  # Lightweight WhatsApp Gateway (Alternative to WAHA)
  - type: web
    name: whatsapp-service
    runtime: docker
    region: oregon
    plan: free
    dockerfilePath: ./whatsapp-service/Dockerfile
    autoDeploy: true
    envVars:
      # Enable real WhatsApp integration for production
      - key: ENABLE_REAL_WHATSAPP
        value: "true"
      # WhatsApp -> Assistant (public URL of Flask webhook)
      - key: WHATSAPP_HOOK_URL
        value: https://waha-gemini-assistant.onrender.com/webhook
      - key: WHATSAPP_HOOK_EVENTS
        value: message
      # Don't show QR in logs to save memory
      - key: SHOW_QR
        value: "true"
      # Browser stability settings
      - key: PUPPETEER_SKIP_CHROMIUM_DOWNLOAD
        value: "true"
      - key: PUPPETEER_EXECUTABLE_PATH
        value: "/usr/bin/chromium-browser"
