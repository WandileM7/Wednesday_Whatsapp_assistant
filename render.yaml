services:
  # Your WhatsApp Assistant (Flask + Gemini)
  - type: web
    name: waha-gemini-assistant
    runtime: docker
    region: oregon
    plan: free
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    envVars:
      - key: WAHA_URL
        value: https://whatsapp-service-8vgb.onrender.com/api/sendText
      - key: WAHA_SESSION
        value: default
      - key: WAHA_KEEPALIVE_INTERVAL
        value: 600
      # Spotify redirect must match your Flask callback route
      - key: SPOTIFY_REDIRECT_URI
        value: https://waha-gemini-assistant.onrender.com/callback

  # Baileys WhatsApp Gateway - NO Chromium Required!
  # Memory usage: ~50-100MB (perfect for free tier)
  - type: web
    name: whatsapp-service
    runtime: docker
    region: oregon
    plan: free
    dockerfilePath: ./whatsapp-service/Dockerfile
    autoDeploy: true
    envVars:
      # Baileys doesn't need Chromium - uses WebSocket directly
      - key: ENABLE_REAL_WHATSAPP
        value: "true"
      # WhatsApp -> Assistant webhook
      - key: WHATSAPP_HOOK_URL
        value: https://waha-gemini-assistant.onrender.com/webhook
      - key: WHATSAPP_HOOK_EVENTS
        value: message
      # Display settings
      - key: SHOW_QR
        value: "false"
      - key: MAX_RECONNECT_ATTEMPTS
        value: "5"
      # Session management
      - key: SESSION_PATH
        value: "/app/session"
      # Logging level (warn for production)
      - key: LOG_LEVEL
        value: "warn"
