services:
  # Your WhatsApp Assistant (Flask + Gemini)
  - type: web
    name: waha-gemini-assistant
    runtime: docker
    region: oregon
    plan: free
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    envVars:
      # Assistant -> WAHA (public URL of WAHA service)
      - key: WAHA_URL
        value: https://waha-service.onrender.com/api/sendText
      - key: WAHA_SESSION
        value: default
      - key: WAHA_KEEPALIVE_INTERVAL
        value: 600
      # Spotify redirect must match your Flask callback route
      - key: SPOTIFY_REDIRECT_URI
        value: https://waha-gemini-assistant.onrender.com/callback

  # Redis service for WAHA session storage (optional - eliminates Redis connection errors)
  # Note: Uncomment this section if you want to eliminate Redis errors (requires paid plan)
  # - type: redis
  #   name: waha-redis
  #   region: oregon
  #   plan: starter
  #   ipAllowList: []

  # WAHA WhatsApp Gateway
  - type: web
    name: waha-service
    runtime: image
    region: oregon
    plan: free
    image:
      url: devlikeapro/waha:latest
    autoDeploy: true
    envVars:
      - key: WAHA_SESSION
        value: default
      - key: WAHA_APPS_ENABLED
        value: "true"
      # Uncomment the next line if you enable the Redis service above
      # - key: REDIS_URL
      #   value: redis://waha-redis:6379
      # WAHA -> Assistant (public URL of Flask webhook)
      - key: WHATSAPP_HOOK_URL
        value: https://waha-gemini-assistant.onrender.com/webhook
      - key: WHATSAPP_HOOK_EVENTS
        value: message
      # Note: WAHA logs Redis connection errors but functions normally without Redis
